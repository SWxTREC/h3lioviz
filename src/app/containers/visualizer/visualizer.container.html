<div *ngIf="!validConnection" class="viz__loading viz__loading--disconnect">
    <ng-container *ngIf="errorMessage">
        <p class="viz__error">{{ errorMessage }}</p>
        <button mat-raised-button color="primary" (click)="refresh()">Retry connection</button>
    </ng-container>
    <swt-server-status *ngIf="!errorMessage"></swt-server-status>
    <p *ngIf="!errorMessage && !pvServerStarted">{{waitingMessage}}</p>
    <p *ngIf="!errorMessage && pvServerStarted">connecting to websocketâ€¦</p>
    <mat-spinner *ngIf="!errorMessage" color="primary" diameter="40"></mat-spinner>
</div>
<div class="viz" [style.height]="componentMaxHeight + 'px'" [class.viz__fade]="!validConnection">
    <as-split unit="pixel" [direction]="splitDirection" (dragEnd)="dragEnd($event)">
        <as-split-area class="viz__panel viz__panel--full-width" [size]="vizSize" [maxSize]="vizMax">
            <div class="viz__container" >
                <div class="viz__overlay">
                    <div class="viz__menus">
                        <swt-layer-menu [pvView]="pvView"></swt-layer-menu>
                        <swt-orientation-menu [pvView]="pvView"></swt-orientation-menu>
                        <swt-zoom-menu [pvView]="pvView"></swt-zoom-menu>
                        <swt-color-menu [pvView]="pvView"></swt-color-menu>
                    </div>
                    <swt-hints class="viz__hints"></swt-hints>
                    <div *ngIf="loading" class="viz__loading">
                        <mat-spinner color="accent" diameter="40"></mat-spinner>
                    </div>
                </div>
                <div #pvContent class="viz__pv" [class.viz__pv--empty]="(runId$ | async) == null" [style.height]="vizMax + 'px'" [style.width]="vizMax + 'px'"></div>
            </div>
            <swt-time-player *ngIf="timeTicks.length && (runId$ | async)" [pvView]="pvView" [timeIndex]="timeIndex" [timeTicks]="timeTicks" (updateTime)="setTimestep($event)"></swt-time-player>
        </as-split-area>
        <!-- for the weird $any, see https://github.com/angular-split/angular-split/issues/220 -->
        <as-split-area class="viz__panel" [size]="$any('*')" >
            <swt-run-selector class="viz__row" *ngIf="catalog && validConnection" [runId]="runId$ | async" [catalog]="catalog" (updateRunId)="updateRunId($event)"></swt-run-selector>
            <mat-hint *ngIf="validConnection" class="viz__error viz__error--warn">{{ errorMessage }}</mat-hint>
            <swt-plots *ngIf="timeTicks.length && (runId$ | async)" [timeRange]="[timeTicks[0], timeTicks[timeTicks.length-1]]"></swt-plots>
        </as-split-area>
    </as-split>
</div>
